<html>

<head>

    <link href="styles/index.css" rel="stylesheet" type="text/css">

    <link href="/bower_components/mdi/css/materialdesignicons.min.css" media="all" rel="stylesheet"
          type="text/css"/>

    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/bower_components/underscore/underscore-min.js"></script>
    <script src="/bower_components/raphael/raphael-min.js"></script>

    <script src="js/production.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {

            var color = {
                continent: {
                    fill: "#d20d0d",
                    stroke: "#a32628",
                },
                circle: {
                    fill: "#e5e5e5",
                    text: "7b7e83",
                    hover: {
                        fill: "#d40e0f",
                        text: "#ffffff"
                    }
                }
            };

            function Continent(map, data, name){

                this.paths = [];
                this.name = name;

                this.init(map, data);
            }

            Continent.prototype = {
                init: function(map, data){

                    var self = this;
                    var paths = data[this.name];
                    _.each(paths, function(path) {

                        var path = map.path(path);
                        path.attr("fill", color.continent.fill);
                        path.attr("stroke", color.continent.stroke);
                        path.attr("opacity", 0);

                        self.paths.push(path);
                    });
                },
                show: function(){
                    _.each(this.paths, function(path){
                        path.animate({"opacity": 0.5}, 100);
                    });
                },
                hide: function(){
                    _.each(this.paths, function(path){
                        path.animate({"opacity": 0}, 100);
                    });
                }
            };

            function Label(name, fullName){
                this.name = name;
                this.fullName = fullName;
            }

            Label.prototype = {
                init: function(x, y, r, map,data){
                    var self = this;

                    this.continent =  new Continent(map,data, this.name);

                    var circle = map.circle(x, y, r);
                    circle.attr("fill",color.circle.fill);
                    circle.attr("stroke", 0);
                    circle.toFront();
                    circle.glow({color: "#41474c", width: 5, opacity: 0.5, offsety: 2.5});

                    this.value = map.text(x, y, "4,56")
                            .attr({fill: color.circle.text,
                                "font-family": "Open Sans", "font-size": "15.6px", "font-weight": 600});

                    this.title = map.text(x, y-5, this.fullName)
                            .attr({fill: color.circle.hover.text, "opacity" : 0,
                                "font-family": "Open Sans", "font-size": "13px", "font-weight": 400});

                    var elementSet = map.set();
                    elementSet.push(circle);
                    elementSet.push(this.value);
                    elementSet.push(this.title);

                    elementSet.attr('cursor','pointer');

                    elementSet.hover(function () {
                                var x = circle.getBBox().x;
                                var y = circle.getBBox().y;

                                self.continent.show();
                                self.title.attr({"opacity" : 1});
                                self.value.translate(0, 25).attr({fill: color.circle.hover.text});

                                circle.animate({"fill": color.circle.hover.fill}, 100);
                            },
                            function () {
                                self.continent.hide();
                                self.title.attr({"opacity" : 0});
                                self.value.translate(0, -25).attr({fill: color.circle.text});
                                circle.animate({"fill": color.circle.fill}, 100);
                            });

                },

                update: function(current){
                    var value = current[this.name];
                    this.value.attr({"text" : value});
                }
            }

            function Map(){
                this.year = "2014";
                this.type = "type1";
                this.labels = [];
                this.init();
            }

            Map.prototype = {

                init: function(){

                    var self = this;
                    var map = Raphael($('.map-graph').get(0), 1570, 724);

                    $.getJSON("map.json", function (data) {
                        $.getJSON("values.json", function (values) {

                            self.values = values;

                            var nordAmerica = new Label('nordAmerica', 'Северная \n Америка');
                            nordAmerica.init(330, 185, 47, map, data);
                            self.labels.push(nordAmerica);

                            var southAmerica = new Label('southAmerica', 'Центральная \n и Южная \n Америка');
                            southAmerica.init(530, 450, 50.5, map, data);
                            self.labels.push(southAmerica);

                            var africa = new Label('africa', 'Африка');
                            africa.init(730, 360, 40, map, data);
                            self.labels.push(africa);

                            var europe = new Label('europe', 'Европа');
                            europe.init(930, 170, 45, map, data);
                            self.labels.push(europe);

                            var azia = new Label('azia', 'Азия');
                            azia.init(1180, 300, 52, map, data);
                            self.labels.push(azia);

                            var australia = new Label('australia', 'Австралия');
                            australia.init(1350, 530, 37.5, map, data);
                            self.labels.push(australia);

                            $('.map-type-item').on('click', function () {
                                $('.map-type-item').removeClass('active');
                                $(this).addClass('active');

                                self.type = $(this).attr('data-type');
                                self.updateLabels();
                            });

                            $('.map-years-prev').on('click', function () {
                                var $items = $('.map-years-items');
                                var margin = parseInt($items.css('margin-right'));

                                if (margin == -750)
                                    return;

                                $items.animate({
                                    marginRight: (margin - 75 * 5) + 'px'
                                }, 300);
                            });

                            $('.map-years-next').on('click', function () {
                                var $items = $('.map-years-items');
                                var margin = parseInt($items.css('margin-right'));

                                if (margin == 0)
                                    return;

                                $items.animate({
                                    marginRight: (margin + 75 * 5) + 'px'
                                }, 300);
                            });

                            $('.map-years-items-item').on('click', function () {
                                $('.map-years-items-item').removeClass('active');
                                $(this).addClass('active');

                                self.year = $(this).attr('data-year');
                                self.updateLabels();
                            });

                            self.updateLabels();
                        });

                    });
                },

                updateLabels: function(){

                    var current = this.values[this.type][this.year];

                    _.each(this.labels, function(label){
                       label.update(current);
                    });

                }
            }


            var map = new Map();

        });

    </script>

</head>

<body>

<header>
    <div class="header">
        <div class="header-description"> Сайт об алюминии</div>
        <div class="header-title"> Экономика</div>
        <div class="header-actions">
            <div class="header-actions-lang"> en</div>
            <i class="mdi mdi-magnify"></i>
            <i class="mdi mdi-menu"></i>
        </div>
    </div>
</header>

<main>
    <div class="main">
        <div class="main-title">
            <h1> Как устроен мировой рынок алюминия? </h1>
        </div>

        <div class="main-description">
            <div class="main-description-item">
                Алюминий является одним из биржевых товаров. Это означает, что его характеристики стандартизированы и
                для
                потребителя не важно, кто именно в мире его произвел. Мировая цена на алюминий ежедневно определяется в
                ходе
                торгов на международных биржах, специализирующихся на биржевых товарах. Производством алюминия
            </div>
            <div class="main-description-item">
                занимаются десятки компаний по всему миру, при этом половина всего произведенного «крылатого металла»
                приходится
                на десять крупнейших производителей. Алюминий – второй по популярности конструктивный материал в мире
                после
                железа, его потребителями являются практически все отрасли промышленности.
            </div>
        </div>

        <div class="map">
            <h2> Общий мировой объем добычи бокситов </br> и производства глинозема (млн.т) </h2>

            <div class="map-container">

                <div class="map-graph">

                </div>

                <div class="map-type">
                    <div class="map-type-item active" data-type="type1">
                        <div> Добыча бокситов </div>
                    </div>
                    <div class="map-type-item" data-type="type2">
                        <div> Производство глинозема </div>
                    </div>
                    <div class="map-type-item" data-type="type3">
                        <div> Производство алюминия </div>
                    </div>
                </div>

                <div class="map-years">
                    <div class="map-years-prev"> <i class="mdi mdi-chevron-left"></i> </div>
                    <div class="map-years-container">
                        <div class="map-years-items">
                            <div class="map-years-items-item" data-year="2000"> <div> 2000 </div> </div>
                            <div class="map-years-items-item" data-year="2001"> <div> 2001 </div> </div>
                            <div class="map-years-items-item" data-year="2002"> <div> 2002 </div> </div>
                            <div class="map-years-items-item" data-year="2003"> <div> 2003 </div> </div>
                            <div class="map-years-items-item" data-year="2004"> <div> 2004 </div> </div>
                            <div class="map-years-items-item" data-year="2005"> <div> 2005 </div> </div>
                            <div class="map-years-items-item" data-year="2006"> <div> 2006 </div> </div>
                            <div class="map-years-items-item" data-year="2007"> <div> 2007 </div> </div>
                            <div class="map-years-items-item" data-year="2008"> <div> 2008 </div> </div>
                            <div class="map-years-items-item" data-year="2009"> <div> 2009 </div> </div>
                            <div class="map-years-items-item" data-year="2010"> <div> 2010 </div> </div>
                            <div class="map-years-items-item" data-year="2011"> <div> 2011 </div> </div>
                            <div class="map-years-items-item" data-year="2012"> <div> 2012 </div> </div>
                            <div class="map-years-items-item" data-year="2013"> <div> 2013 </div> </div>
                            <div class="map-years-items-item active" data-year="2014"> <div> 2014 </div> </div>
                        </div>
                    </div>
                    <div class="map-years-next"> <i class="mdi mdi-chevron-right"></i> </div>
                </div>
            </div>
        </div>

        <div class="production">
            <h2> Производство и потребление алюминия в мире </h2>

            <div class="production-legend">
                <div class="production-legend-item">
                    <div class="production-legend-item-consumption">

                    </div>
                    <div> Потребление</div>
                </div>
                <div class="production-legend-item">
                    <div class="production-legend-item-production">

                    </div>
                    <div> Производство</div>
                </div>
            </div>

            <div class="production-graph">
                <div class="production-graph-main">
                    <div class="production-graph-values">
                        <div> 60 000</div>
                        <div> 50 000</div>
                        <div> 40 000</div>
                        <div> 30 000</div>
                        <div> 20 000</div>
                        <div> 10 000</div>
                        <div> 0</div>
                    </div>
                    <div class="production-graph-container"></div>
                </div>
                <div class="production-graph-years">
                    <div> 2000</div>
                    <div> 2001</div>
                    <div> 2002</div>
                    <div> 2003</div>
                    <div> 2004</div>
                    <div> 2005</div>
                    <div> 2006</div>
                    <div> 2007</div>
                    <div> 2008</div>
                    <div> 2009</div>
                    <div> 2010</div>
                    <div> 2011</div>
                    <div> 2012</div>
                    <div> 2013</div>
                    <div> 2014</div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer>

    <div class="footer">
        <div class="footer-container">
            <div class="footer-description">
                <div class="footer-description-text">
                    Сайт об алюминии. Проект <a href="#"> UC RUSAL </a>, крупнейшего
                    <br/>
                    в мире производителя алюминия и глинозема.
                </div>
                <div class="footer-description-copyright">
                    2015 РУСАЛ Все права защищены
                </div>
            </div>

            <div class="footer-urls">
                <a href="#">Применение </a>
                <a href="#"> Об алюминии </a>
                <a href="#">Производство </a>
            </div>

            <div class="footer-urls">
                <a href="#"> История металла </a>
                <a href="#"> Экономика </a>
                <a href="#"> О проекте </a>
            </div>

            <div class="footer-text">
                uplab
            </div>

        </div>
    </div>

</footer>


</body>
</html>